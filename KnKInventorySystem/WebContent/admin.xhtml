<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">
<h:head>
	<title>login</title>
	<f:metadata>
		<f:event type="preRenderView" listener="#{adminPanelBean.init()}" />
	</f:metadata>
</h:head>
<h:body>
	<h:form id="form" style="font-size:0.75em">
		<p:growl id="growl" showDetail="true" autoUpdate="true" />
		<p:toolbar>
			<f:facet name="left">
				Добре дошли, #{login.user}
				<span class="ui-separator"> <span
					class="ui-icon ui-icon-grip-dotted-vertical" />
				</span>
			</f:facet>

			<f:facet name="right">
				<p:commandButton value="Инвентар"
					action="#{navigationHandler.navigateToInventory()}" />
				<p:commandButton value="Изход" action="#{login.logout()}" />
			</f:facet>
		</p:toolbar>
		<p:messages id="messages" showDetail="true" autoUpdate="true"
			closable="true" />
		<p:tabView id="tabview">
			<p:tab id="stocktab" title="Управление на артикули"
				style="font-size:0.75em">
				<p:panelGrid id="stockpnlgrid" columns="2">
					<p:treeTable id="stocktable" var="stock"
						value="#{adminPanelBean.root}"
						selection="#{adminPanelBean.selectedNode}" selectionMode="single"
						rowKey="#{stock.itemID}" scrollable="true" scrollHeight="300">
						<p:ajax event="select" listener="#{adminPanelBean.setselected()}"
							update="form:tabview:AddStockQuantitypanel" />
						<p:column headerText="Категория">
			#{stock.cat.itemCategory}
			 	</p:column>
						<p:column headerText="Код">
			#{stock.item.itemCode}
			 	</p:column>
						<p:column headerText="Вариация">
			#{stock.item.itemVariation}
			 	</p:column>
						<p:column headerText="Цвят">
			#{stock.item.color}
			 	</p:column>
						<p:column headerText="Наличност">
			#{stock.item.stock}
			 	</p:column>
						<p:column headerText="Цена">
			#{stock.item.price}
			 	</p:column>
					</p:treeTable>

					<p:panel id="AddStockQuantitypanel" header="Опции за артикул">
						<p:panelGrid columns="2">
		Код
		<p:inputText value="#{adminPanelBean.selectedItem.item.itemCode}"
								readonly="true" disabled="true" />
		Вариация
		<p:inputText value="#{adminPanelBean.selectedItem.item.itemVariation}"
								readonly="true" disabled="true" />
		Наличност
		<p:inputText value="#{adminPanelBean.selectedItem.item.stock}"
								readonly="true" disabled="true" />
		Количество
		<p:inputText binding="#{qty}" type="number" />
							<p:commandButton value="Добави"
								action="#{adminPanelBean.addStockQuantity(qty.value,login.user)}"
								update="form:tabview:stockpnlgrid" />
							<p:commandButton value="Изтрий"
								action="#{adminPanelBean.deleteStock(login.user)}"
								update="form:tabview:stockpnlgrid" />
						</p:panelGrid>
					</p:panel>

					<p:panel id="addStock" header="Добавяне на арткул"
						style="width:450px">
						<p:panelGrid columns="2">
		Код
		<p:inputText value="#{adminPanelBean.newitem.itemCode}" />
		Вариация
		<p:inputText value="#{adminPanelBean.newitem.itemVariation}" />
		Категория
		<p:selectOneMenu value="#{adminPanelBean.newitem.itemCategory}">
								<f:selectItems value="#{adminPanelBean.categories}" />
							</p:selectOneMenu>
		Цвят
		<p:inputText value="#{adminPanelBean.newitem.color}" />
		Цена
		<p:inputNumber value="#{adminPanelBean.newitem.price}" />
		Наличност
		<p:inputText value="#{adminPanelBean.newitem.stock}" type="number" />
							<p:commandButton value="Добави	"
								action="#{adminPanelBean.addStock()}"
								update="form:tabview:stockpnlgrid" />
							<p:fileUpload value="#{adminPanelBean.file}"
								fileUploadListener="#{adminPanelBean.upload}" auto="true"
								allowTypes="/(\.|\/)(gif|jpe?g|png)$/" mode="advanced"
								skinSimple="true" />
						</p:panelGrid>
					</p:panel>
					<p:panel id="catpanel" header="Управление на категории"
						style="width:450px;height:280px">
						<p:panelGrid columns="2">
							<p:selectOneListbox id="categories"
								value="#{adminPanelBean.selectedCategory}">
								<p:ajax event="change" partialSubmit="true" />
								<f:selectItems value="#{adminPanelBean.categories}" />
							</p:selectOneListbox>
							<p:commandButton value="Изтрий"
								action="#{adminPanelBean.deleteCategory()}"
								update="form:tabview:stockpnlgrid" process="@this"
								partialSubmit="true" />
							<p:inputText binding="#{newcat}" />
							<p:commandButton value="Добави"
								action="#{adminPanelBean.addCategory(newcat.value)}"
								update="form:tabview:stockpnlgrid" />
						</p:panelGrid>
					</p:panel>
				</p:panelGrid>
			</p:tab>
			<p:tab id="usermgmtTab" title="Управление на потребители"
				style="font-size:0.75em">

				<p:panelGrid id="usergrid" columns="2">
					<p:dataTable id="errorTable" var="errors"
						value="#{adminPanelBean.historyList}"
						selection="#{adminPanelBean.selectedHistory}"
						selectionMode="single" rowKey="#{errors.logID}"
						style="font-size:0.75em">
						<p:column headerText="Код">
			#{errors.itemCode}
			</p:column>
						<p:column headerText="Вариация">
			#{errors.itemVariation}
			</p:column>
						<p:column headerText="Наличност">
			#{errors.quantity}
			</p:column>
						<p:column headerText="Служител">
			#{errors.employee}
			</p:column>
						<p:column headerText="Детайли на поръчката">
			#{errors.orderDetails}
			</p:column>
						<p:column headerText="Дата">
			#{errors.timestamp}
			</p:column>
						<f:facet name="footer">
							<p:commandButton value="Потвърди грешка"
								action="#{adminPanelBean.approveMarkedError()}"
								update="errorTable" />
						</f:facet>
					</p:dataTable>
					<p:panel id="loginpanel">
						<p:panelGrid columns="3">
							<p:selectOneListbox value="#{adminPanelBean.selectedLogin}"
								scrollHeight="150">
								<p:ajax partialSubmit="true" event="change"
									update="form:tabview:usergrid" />
								<f:selectItems value="#{adminPanelBean.loginsList}" />
							</p:selectOneListbox>
							<p:panel>
								<p:panelGrid columns="2">
								Потребител <p:inputText binding="#{addusr}" />
								Парола <p:inputText binding="#{addpwd}" />
									<p:commandButton value="Добави"
										action="#{adminPanelBean.addUser(addusr.value,addpwd.value)}"
										update="form:tabview:usergrid" />
									<p:commandButton value="Изтрий"
										action="#{adminPanelBean.removeUser()}"
										update="form:tabview:usergrid" />
								</p:panelGrid>
							</p:panel>
							<p:panelGrid columns="2">
							Администраторски Достъп
							<p:selectBooleanCheckbox
									value="#{adminPanelBean.newuser_adminEnabled}" />
							</p:panelGrid>
						</p:panelGrid>
					</p:panel>
				</p:panelGrid>

			</p:tab>
			<p:tab title="Отчети">
				<p:panel id="reportpanel">
					<p:selectOneMenu value="#{adminPanelBean.reportSearchType}"
						size="5">
						<f:selectItem itemValue="usr" itemLabel="Потребител" />
						<f:selectItem itemValue="cat" itemLabel="Категория" />
						<f:selectItem itemValue="item" itemLabel="Артикул(Код)" />
						<f:selectItem itemValue="order" itemlabel="Поръчка" />
					</p:selectOneMenu>
						Търсене: <p:inputText binding="#{reportInput}" size="5"
						style="margin-bot:5px" />
						От: <p:calendar value="#{adminPanelBean.dateFrom}"
						pattern="yyyy-MM-dd" size="5">
					</p:calendar>
						До:	<p:calendar value="#{adminPanelBean.dateTo}"
						pattern="yyyy-MM-dd" size="5">
					</p:calendar>
					<p:commandButton value="Отчет"
						action="#{adminPanelBean.getReport(reportInput.value)}"
						update="reportTable" style="margin-left: 10px" />
					<p:commandButton value="Изчисти"
						action="#{adminPanelBean.clearReport()}" update="reportTable"
						style="margin-left: 10px" />
					<p:dataTable id="reportTable" var="report"
						value="#{adminPanelBean.userReport}" scrollable="true"
						scrollHeight="340">
						<p:ajax event="rowSelect" partialSubmit="true" />
						<p:column headerText="Служител">
				#{report.employee}
			</p:column>
						<p:column headerText="Категория">
				#{report.itemCategory}
			</p:column>
						<p:column headerText="Код">
				#{report.itemCode}
			</p:column>
						<p:column headerText="Вариация">
				#{report.itemVariation}
			</p:column>
						<p:column headerText="Количество">
				#{report.quantity}
			</p:column>
						<p:column headerText="Дата">
				#{report.timestamp}
			</p:column>
						<p:column headerText="Детайли на поръчката">
				#{report.orderDetails}
			</p:column>
					</p:dataTable>

				</p:panel>
			</p:tab>
		</p:tabView>


	</h:form>
</h:body>
</html>